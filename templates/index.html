<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panneau de Contrôle - Serveur Pi</title>
    <!-- Intégration de Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            max-width: 800px;
        }
        .card {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">Panneau de Contrôle du Serveur</h1>
        <div id="alert-placeholder"></div>
        <form id="settings-form">
            <!-- Section Wi-Fi -->
            <div class="card">
                <div class="card-header">
                    <h3>Configuration du Hotspot Wi-Fi</h3>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="wifi_ssid" class="form-label">Nom du réseau (SSID)</label>
                        <input type="text" class="form-control" id="wifi_ssid" name="wifi_ssid" value="{{ current_ssid }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="wifi_password" class="form-label">Mot de passe Wi-Fi</label>
                        <input type="password" class="form-control" id="wifi_password" name="wifi_password" placeholder="Laisser vide pour ne pas changer">
                        <div class="form-text">Le mot de passe doit contenir au moins 8 caractères.</div>
                    </div>
                </div>
            </div>

            <!-- Section Partage de Fichiers -->
            <div class="card">
                <div class="card-header">
                    <h3>Configuration du Partage de Fichiers (Samba)</h3>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="drive_to_share" class="form-label">Disque à partager</label>
                        <select class="form-select" id="drive_to_share" name="drive_to_share" required>
                            <option selected disabled value="">Choisissez un disque...</option>
                            {% for drive in drives %}
                                <option value="{{ drive.name }}">{{ drive.label }} ({{ drive.size }}) - {{ drive.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="share_password" class="form-label">Mot de passe du partage</label>
                        <input type="password" class="form-control" id="share_password" name="share_password" placeholder="Laisser vide pour ne pas changer">
                        <div class="form-text">Définit un mot de passe pour accéder au disque partagé.</div>
                    </div>
                </div>
            </div>

            <div class="d-grid gap-2 mt-4">
                <button type="submit" class="btn btn-primary btn-lg">Enregistrer les modifications</button>
            </div>
        </form>
    </div>

    <!-- Intégration de Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const alertPlaceholder = document.getElementById('alert-placeholder');
        const form = document.getElementById('settings-form');

        const showAlert = (message, type) => {
            const wrapper = document.createElement('div');
            wrapper.innerHTML = [
                `<div class="alert alert-${type} alert-dismissible" role="alert">`,
                `   <div>${message}</div>`,
                '   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',
                '</div>'
            ].join('');
            alertPlaceholder.append(wrapper);
        };

        form.addEventListener('submit', (event) => {
            event.preventDefault();

            const formData = new FormData(form);
            
            // Validation simple côté client
            const wifi_password = formData.get('wifi_password');
            if (wifi_password && wifi_password.length < 8) {
                showAlert('Le mot de passe Wi-Fi doit faire au moins 8 caractères.', 'warning');
                return;
            }

            fetch('/save', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    showAlert('<strong>Succès !</strong> ' + data.message, 'success');
                } else {
                    showAlert('<strong>Erreur :</strong> ' + data.message, 'danger');
                }
                window.scrollTo(0, 0);
            })
            .catch(error => {
                showAlert('<strong>Erreur réseau.</strong> Impossible de contacter le serveur.', 'danger');
                window.scrollTo(0, 0);
            });
        });
    </script>
</body>
</html>
